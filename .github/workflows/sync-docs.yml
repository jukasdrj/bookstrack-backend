name: üìö Sync API Docs to Other Repos

on:
  push:
    branches: [main]
    paths:
      - 'docs/API_README.md'
      - 'docs/QUICK_START.md'
      - '.github/workflows/sync-docs.yml'

jobs:
  sync-to-ios:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Sync docs to iOS repo
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          # Configure git
          git config --global user.email "claude@anthropic.com"
          git config --global user.name "Claude Code"
          
          # Clone iOS repo (shallow)
          git clone --depth 1 https://github.com/jukasdrj/books-tracker-v1.git /tmp/ios-repo 2>&1 || {
            echo "‚ö†Ô∏è  Could not clone iOS repo (may not exist yet)"
            exit 0
          }
          
          # Create docs dir if needed
          mkdir -p /tmp/ios-repo/docs
          
          # Copy files
          cp docs/API_README.md /tmp/ios-repo/docs/
          cp docs/QUICK_START.md /tmp/ios-repo/docs/
          
          # Commit and push if changed
          cd /tmp/ios-repo
          if ! git diff --quiet docs/; then
            git add docs/API_README.md docs/QUICK_START.md
            git commit -m "docs: sync API documentation from backend

Synced from bookstrack-backend: ${{ github.server_url }}/${{ github.repository }}/commit/${{ github.sha }}

- API_README.md: Canonical contracts, endpoints, WebSocket protocol
- QUICK_START.md: Quick reference for common tasks

Keep in sync with: github.com/jukasdrj/bookstrack-backend/docs/"
            git push origin main
            echo "‚úÖ iOS repo docs updated"
          else
            echo "‚ÑπÔ∏è  No changes to sync to iOS repo"
          fi

  sync-to-flutter:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Sync docs to Flutter repo
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          # Configure git
          git config --global user.email "claude@anthropic.com"
          git config --global user.name "Claude Code"
          
          # Clone Flutter repo (shallow)
          git clone --depth 1 https://github.com/jukasdrj/books-flutter.git /tmp/flutter-repo 2>&1 || {
            echo "‚ö†Ô∏è  Could not clone Flutter repo (may not exist yet)"
            exit 0
          }
          
          # Create docs dir if needed
          mkdir -p /tmp/flutter-repo/docs
          
          # Copy files
          cp docs/API_README.md /tmp/flutter-repo/docs/
          cp docs/QUICK_START.md /tmp/flutter-repo/docs/
          
          # Commit and push if changed
          cd /tmp/flutter-repo
          if ! git diff --quiet docs/; then
            git add docs/API_README.md docs/QUICK_START.md
            git commit -m "docs: sync API documentation from backend

Synced from bookstrack-backend: ${{ github.server_url }}/${{ github.repository }}/commit/${{ github.sha }}

- API_README.md: Canonical contracts, endpoints, WebSocket protocol
- QUICK_START.md: Quick reference for common tasks

Keep in sync with: github.com/jukasdrj/bookstrack-backend/docs/"
            git push origin main
            echo "‚úÖ Flutter repo docs updated"
          else
            echo "‚ÑπÔ∏è  No changes to sync to Flutter repo"
          fi

  notify:
    runs-on: ubuntu-latest
    if: always()
    steps:
      - name: Summary
        run: echo "üìö Documentation sync workflow complete"
